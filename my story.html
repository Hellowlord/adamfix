<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Adam Fix Store</title>
  <style>
    body {
      margin:0;
      font-family: Arial, sans-serif;
      background: linear-gradient(270deg,#ff7eb3,#ff758c,#42a5f5,#7e57c2);
      color: white; text-align:center; padding:20px;
    }
    h1 { text-shadow:0 0 12px rgba(0,0,0,0.5); }
    .items p { cursor:pointer; background:rgba(255,255,255,0.08); padding:12px; border-radius:8px; margin:8px auto; width:320px; color:yellow; }
    form { display:none; margin:20px auto; background:rgba(0,0,0,0.45); padding:16px; width:360px; border-radius:10px; text-align:left; }
    input, textarea, button { width:100%; padding:10px; margin:8px 0; border-radius:6px; border:none; font-size:14px; }
    button { background:#42a5f5; color:#fff; cursor:pointer; }
    button[disabled] { opacity:0.6; cursor:default; }
    #status { margin-top:10px; font-size:14px; color:lightgreen; white-space:pre-line; }
    #err { color:#ffb3b3; font-size:13px; margin-top:8px; white-space:pre-line; }
  </style>
</head>
<body>
  <h1>Adam Fix Store</h1>
  <p>Click an item to fill the form</p>

  <div class="items">
    <p onclick="prefill('Calculator','987 EGP')">üßÆ Calculator ‚Äî 987 EGP</p>
    <p onclick="prefill('Gun Toy','100 EGP')">üî´ Gun Toy ‚Äî 100 EGP</p>
    <p onclick="prefill('Toy Car','200 EGP')">üöó Toy Car ‚Äî 200 EGP</p>
    <p onclick="prefill('Tie','50 EGP')">üëî Tie ‚Äî 50 EGP</p>
  </div>

  <form id="orderForm">
    <h2>Buy Item</h2>
    <input type="hidden" name="item" id="item" />
    <input type="hidden" name="cash" id="cash" />
    <label>Your email</label>
    <input type="email" name="user_email" id="user_email" required />
    <label>Phone number</label>
    <input type="text" name="number" required />
    <label>Address</label>
    <input type="text" name="address" required />
    <label>Message / What happened</label>
    <textarea name="message"></textarea>
    <button id="submitBtn" type="submit">Buy</button>
    <div id="status"></div>
    <div id="err"></div>
  </form>

  <!-- EmailJS -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    // ==== CONFIG (your values) ====
    const EMAILJS_SERVICE = "service_fdy3h4j";
    const EMAILJS_TEMPLATE = "template_s37d2qa";
    const EMAILJS_PUBLIC_KEY = "h0dABymW32jwHiXli";
    const FORMSPREE_ENDPOINT = "https://formspree.io/f/xjkenzwo";

    (function(){
      try { 
        emailjs.init(EMAILJS_PUBLIC_KEY); 
        console.log("EmailJS initialized with public key"); 
      } catch(e){ 
        console.error("EmailJS init error:", e); 
      }
    })();

    function prefill(itemName, cashVal) {
      document.getElementById("orderForm").style.display = "block";
      document.getElementById("item").value = itemName;
      document.getElementById("cash").value = cashVal;
      document.getElementById("status").innerText = "";
      document.getElementById("err").innerText = "";
    }

    document.getElementById("orderForm").addEventListener("submit", async function(ev){
      ev.preventDefault();
      const form = ev.target;
      const submitBtn = document.getElementById("submitBtn");
      const status = document.getElementById("status");
      const errDiv = document.getElementById("err");

      submitBtn.disabled = true;
      status.innerText = "‚è≥ Sending order‚Ä¶";
      errDiv.innerText = "";

      const formData = new FormData(form);

      function finishSuccess(msg){
        status.innerText = msg;
        submitBtn.disabled = false;
        form.reset();
        form.style.display = "none";
      }
      function finishError(msg){
        status.innerText = "";
        errDiv.innerText = msg;  // üõë keep error visible
        submitBtn.disabled = false;
      }

      try {
        const res = await emailjs.sendForm(EMAILJS_SERVICE, EMAILJS_TEMPLATE, form);
        console.log("EmailJS success:", res);
        finishSuccess("‚úÖ Order sent! Confirmation email should arrive shortly.");
        return;
      } catch (emailErr) {
        console.error("EmailJS failed:", emailErr);
        finishError("‚ö†Ô∏è EmailJS failed. See console for details. Trying Formspree fallback‚Ä¶");
      }

      try {
        const resp = await fetch(FORMSPREE_ENDPOINT, {
          method: 'POST',
          body: formData,
          headers: { 'Accept': 'application/json' }
        });
        const text = await resp.text();
        console.log("Formspree response:", resp.status, text);
        if (resp.ok) {
          finishSuccess("‚úÖ Order saved via Formspree fallback.");
        } else {
          finishError("‚ùå Formspree failed (status " + resp.status + "). Check console.");
        }
      } catch (fetchErr) {
        console.error("Formspree fetch error:", fetchErr);
        finishError("‚ùå Both EmailJS and Formspree failed. See console for details.");
      }
    });
  </script>
</body>
</html>
